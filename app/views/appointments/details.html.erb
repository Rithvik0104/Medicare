<h1>Complete Detail of Appointment</h1>
<%if @status == "scheduled"%>
<%= button_to "Cancel Appointment", root_path,method: :get,class:"btn btn-danger"%>
<%else%>

<% if @appointment.feedback.present? %>
 
 <h4>Feedback Submitted</h4>
 <%=button_to "Edit Feedback",root_path,method: :get,class: "btn btn-info"%>

<%else%>
 <button type="button" class="btn btn-info m-1 px-3 feedback-button" data-appointment-id="<%= @appointment_id %>" data-toggle="modal" data-target="#feedbackModal">
        Give Feedback
      </button>
<%end%>

  <%= button_to "Download Invoice", root_path,method: :get,class:"btn btn-outline-success"%>

  <div class="modal fade" id="feedbackModal" tabindex="-1" role="dialog" aria-labelledby="feedbackModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="feedbackModalLabel">Leave Feedback</h5>
        
        </div>
        <div class="modal-body">
          <form action="<%= feedbacks_path %>" method="post">  <div class="form-group">
              <label for="feedback">Your Review</label>
              <textarea class="form-control" id="feedback" name="feedback" rows="3"></textarea>
            </div>
            <div class="form-group">
              <label for="rating">Rating (1-5)</label>
              <select class="form-control" id="rating" name="rating">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
            </div>
          </form>
        <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary confirm-feedback" data-dismiss="modal" >Submit</button>
      </div>
        </div>
      </div>
    </div>
  </div>
<%end%>
<script>

$(document).ready(function() {

  $('.feedback-button').click(function() {
    const appointmentId = $(this).data('appointmentId');
    $('#feedback').val('');  
     $('#rating').val('1');

    $('.confirm-feedback').click(function() {

    const cur_review = $('#feedback').val(); 
    const cur_rating = $('#rating').val(); 

    console.log("Review :", cur_review);
    console.log("Appointment:", appointmentId);
    console.log("Rating out of 5 :",cur_rating);

    const feedbackData = {
      review:cur_review,
      appointment_id:appointmentId,
      rating:cur_rating,
    }

    console.log(feedbackData);
    $.ajax({
            url: `http://localhost:3000/feedbacks`,
            method: "POST",
            data: feedbackData, 
            dataType: "html", 
            success: function (result) {  
              console.log(result);
              window.location.reload();
            },
        });
    });
    
  });
});


</script>